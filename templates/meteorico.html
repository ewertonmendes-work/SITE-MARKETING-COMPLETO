<!DOCTYPE html>
<html lang="pt-BR" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pronix | Dashboard de Campanha</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        // "Roc Grotesk" como primeira opção para quem tem a fonte instalada
                        sans: ['"Roc Grotesk"', '"Archivo"', 'sans-serif'],
                    },
                    colors: {
                        dark: {
                            900: '#000000',
                            800: '#111111',
                            700: '#222222',
                        },
                        brand: {
                            yellow: '#FFC700',
                            purple: '#8B5CF6',
                            emerald: '#10b981',
                        }
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.6s ease-out forwards',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Archivo:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>

    <style>
        body {
            background-color: #000000;
            background-image: radial-gradient(at 50% 0%, rgba(255, 199, 0, 0.1) 0px, transparent 50%);
            background-attachment: fixed;
            color: #f3f4f6;
            -webkit-font-smoothing: antialiased;
        }

        .glass-card {
            background: rgba(17, 17, 17, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            border-color: rgba(255, 199, 0, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.15);
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #000000;
        }

        ::-webkit-scrollbar-thumb {
            background: #222222;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #333333;
        }

        .delay-100 {
            animation-delay: 100ms;
        }

        .delay-200 {
            animation-delay: 200ms;
        }

        .delay-300 {
            animation-delay: 300ms;
        }
    </style>
</head>

<body class="min-h-screen p-4 md:p-8 font-sans">

    <div class="max-w-7xl mx-auto space-y-6">

        <!-- Header Centralizado e Harmonizado -->
        <header
            class="relative flex flex-col items-center pt-8 pb-10 border-b border-gray-800 opacity-0 animate-fade-in-up">

            <!-- Controles Flutuantes Superiores -->
            <div class="absolute top-0 w-full flex justify-between items-center px-2">
                <button onclick="init()"
                    class="p-2 rounded-full hover:bg-gray-800 transition-all border border-transparent hover:border-gray-800 active:scale-95"
                    title="Sincronizar dados">
                    <i data-lucide="refresh-cw" id="refresh-icon"
                        class="w-5 h-5 text-gray-500 hover:text-white transition-colors"></i>
                </button>

                <div
                    class="flex items-center gap-2 px-3 py-1 rounded-full bg-brand-yellow/10 border border-brand-yellow/20 text-brand-yellow text-[9px] font-black uppercase tracking-widest">
                    <img src="https://vdvgroup.com.br/wp-content/uploads/2026/02/RAIO-PEQUENO.png" alt="Raio"
                        class="w-2.5 h-2.5 object-contain animate-pulse-slow">
                    <span id="status-text">Ativa</span>
                </div>
            </div>

            <!-- Logo Pronix -->
            <div class="mb-4">
                <img src="https://vdvgroup.com.br/wp-content/uploads/2026/02/texto_branco_tag_padrao.png"
                    alt="Logo Pronix" class="h-32 md:h-48 w-auto object-contain drop-shadow-lg">
            </div>

            <!-- Título Meteórico -->
            <div class="text-center">
                <h1
                    class="text-4xl md:text-5xl font-black tracking-[0.2em] text-white uppercase drop-shadow-lg leading-none">
                    Meteórico
                </h1>

                <!-- Subtítulo grifado -->
                <div class="mt-6 inline-block">
                    <span
                        class="text-[10px] md:text-xs font-black uppercase tracking-[0.4em] px-4 py-2 bg-brand-yellow text-black rounded-sm shadow-lg shadow-brand-yellow/10">
                        acompanhamento do funil
                    </span>
                </div>
            </div>

            <!-- Botão de Voltar -->
            <div class="mt-8">
                <a href="index.html"
                    class="flex items-center gap-2 text-gray-400 hover:text-brand-yellow transition-colors text-sm font-bold uppercase tracking-wider">
                    <i data-lucide="arrow-left" class="w-4 h-4"></i> Voltar ao Hub Principal
                </a>
            </div>
        </header>

        <!-- Seção Geral -->
        <section class="opacity-0 animate-fade-in-up delay-100">
            <h2 class="text-lg font-semibold text-gray-200 mb-4 flex items-center gap-2 uppercase tracking-tighter">
                <img src="https://vdvgroup.com.br/wp-content/uploads/2026/02/RAIO-PEQUENO.png" alt="Raio"
                    class="w-5 h-5 object-contain">
                Geral
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <!-- Gasto Total -->
                <div class="glass-card rounded-2xl p-6">
                    <div class="flex justify-between items-start">
                        <p class="text-xs font-semibold text-gray-400 uppercase tracking-widest">Gasto Total</p>
                        <div class="p-2 rounded-lg bg-gray-800 text-gray-400"><i data-lucide="dollar-sign"
                                class="w-4 h-4"></i></div>
                    </div>
                    <div class="mt-4">
                        <h3 class="text-3xl font-black text-white flex items-baseline gap-1 tracking-tighter">
                            <span class="text-lg text-gray-500 font-medium">R$</span>
                            <span class="counter" id="val-gasto-total" data-decimals="2">0,00</span>
                        </h3>
                    </div>
                </div>

                <!-- Entradas Totais -->
                <div class="glass-card rounded-2xl p-6 relative overflow-hidden border-brand-yellow/20">
                    <div class="absolute -right-4 -top-4 w-24 h-24 bg-brand-yellow/10 rounded-full blur-2xl"></div>
                    <div class="flex justify-between items-start relative z-10">
                        <p class="text-xs font-semibold text-gray-400 uppercase tracking-widest">Grupo</p>
                        <div class="p-2 rounded-lg bg-brand-yellow/10 text-brand-yellow"><i data-lucide="users"
                                class="w-4 h-4"></i></div>
                    </div>
                    <div class="mt-4 relative z-10">
                        <h3 class="text-5xl font-black text-white counter tracking-tighter" id="val-entradas-totais">0
                        </h3>
                        <p
                            class="text-[9px] text-brand-yellow mt-1 flex items-center gap-1 uppercase font-black tracking-widest">
                            <img src="https://vdvgroup.com.br/wp-content/uploads/2026/02/RAIO-PEQUENO.png" alt="Raio"
                                class="w-3 h-3 object-contain"> Alta energia
                        </p>
                    </div>
                </div>

                <!-- CPA Global -->
                <div class="glass-card rounded-2xl p-6">
                    <div class="flex justify-between items-start">
                        <p class="text-xs font-semibold text-gray-400 uppercase tracking-widest">CPA Geral</p>
                        <div class="p-2 rounded-lg bg-gray-800 text-gray-400"><i data-lucide="activity"
                                class="w-4 h-4"></i></div>
                    </div>
                    <div class="mt-4">
                        <h3 class="text-3xl font-black text-white flex items-baseline gap-1 tracking-tighter">
                            <span class="text-lg text-gray-500 font-medium">R$</span>
                            <span class="counter" id="val-cpa-geral" data-decimals="2">0,00</span>
                        </h3>
                    </div>
                </div>
            </div>

            <!-- Progresso da Meta -->
            <div class="glass-card rounded-2xl p-6 mt-4">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-4 gap-4">
                    <div class="text-left">
                        <h3 class="text-lg font-black text-white uppercase tracking-tight">Progresso da Meta</h3>
                        <p class="text-xs text-gray-400">Faltam <strong class="text-brand-yellow"
                                id="val-gap">0</strong> leads para bater o recorde.</p>
                    </div>
                    <div class="text-left md:text-right">
                        <div class="text-4xl font-black text-white tracking-tighter leading-none"><span class="counter"
                                id="val-porcentagem" data-decimals="2">0</span>%</div>
                        <div class="text-[9px] text-brand-yellow uppercase tracking-widest font-black mt-1">Atingido
                        </div>
                    </div>
                </div>

                <div
                    class="relative w-full h-6 bg-gray-900 rounded-full overflow-hidden border border-gray-800 shadow-inner">
                    <div class="absolute top-0 left-0 h-full bg-gradient-to-r from-gray-800 via-yellow-700 to-brand-yellow rounded-full transition-all duration-1000 ease-out"
                        style="width: 0%" id="progress-bar">
                        <div class="absolute top-0 right-0 w-8 h-full bg-white/30 blur-sm"></div>
                    </div>
                </div>

                <div
                    class="flex justify-between text-[9px] font-black uppercase tracking-widest text-gray-500 mt-2 px-1 text-left">
                    <span>Início</span>
                    <span class="text-gray-400 uppercase">Atual: <span id="val-atual-mini">0</span></span>
                    <span class="text-brand-yellow font-black uppercase">Meta: <span id="val-meta">0</span></span>
                </div>
            </div>
        </section>

        <!-- Canais -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 opacity-0 animate-fade-in-up delay-200">
            <!-- Meta Ads -->
            <section class="glass-card rounded-2xl p-6 flex flex-col h-full border-t-2 border-t-[#1877F2]">
                <div class="flex items-center gap-3 mb-6">
                    <div
                        class="w-10 h-10 rounded-lg bg-[#1877F2]/10 border border-[#1877F2]/20 flex items-center justify-center text-[#1877F2]">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                            <path
                                d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.469h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.469h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-lg font-black text-white uppercase tracking-tight">Funil Meta Ads</h2>
                        <p class="text-[9px] text-gray-500 uppercase tracking-widest font-bold">Facebook e Instagram</p>
                    </div>
                </div>

                <div class="bg-[#0a0a0a] rounded-xl p-4 mb-6 border border-gray-800/50">
                    <div class="flex flex-col sm:flex-row justify-between items-center gap-2 text-center">
                        <div>
                            <span
                                class="text-[9px] text-gray-500 uppercase font-black tracking-widest block mb-1">Gasto</span>
                            <span class="text-lg font-black text-white tracking-tighter">R$ <span
                                    id="val-gasto-meta">0</span></span>
                        </div>
                        <i data-lucide="chevron-right" class="text-gray-700 hidden sm:block"></i>
                        <div>
                            <span
                                class="text-[9px] text-gray-500 uppercase font-black tracking-widest block mb-1">Cliques</span>
                            <span class="text-lg font-black text-white tracking-tighter" id="val-cliques-meta">0</span>
                        </div>
                        <i data-lucide="chevron-right" class="text-gray-700 hidden sm:block"></i>
                        <div>
                            <span
                                class="text-[9px] text-gray-500 uppercase font-black tracking-widest block mb-1">Entradas</span>
                            <span class="text-lg font-black text-[#1877F2] tracking-tighter"
                                id="val-entradas-meta">0</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mt-auto">
                    <div class="bg-gray-800/20 rounded-xl p-4 border border-gray-800/50">
                        <p class="text-[9px] text-gray-400 uppercase font-black tracking-widest mb-1">CPC</p>
                        <p class="text-lg font-black text-white tracking-tighter">R$ <span id="val-cpc-meta">0,00</span>
                        </p>
                    </div>
                    <div class="bg-[#0a0a0a] rounded-xl p-4 border border-gray-800/50">
                        <p class="text-[9px] text-gray-400 uppercase font-black tracking-widest mb-1">CPA Canal</p>
                        <p class="text-lg font-black text-white tracking-tighter">R$ <span id="val-cpa-meta">0,00</span>
                        </p>
                    </div>
                </div>
            </section>

            <!-- Funil WhatsApp -->
            <section class="glass-card rounded-2xl p-6 flex flex-col h-full border-t-2 border-t-[#25D366]">
                <div class="flex items-center gap-3 mb-6">
                    <div
                        class="w-10 h-10 rounded-lg bg-[#25D366]/10 border border-[#25D366]/20 flex items-center justify-center text-[#25D366]">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5">
                            <path
                                d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.347-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.876 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z" />
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-lg font-black text-white uppercase tracking-tight">Funil WhatsApp</h2>
                        <p class="text-[9px] text-gray-500 uppercase tracking-widest font-bold">Disparo e Automação</p>
                    </div>
                </div>

                <div class="bg-[#0a0a0a] rounded-xl p-4 mb-6 border border-gray-800/50">
                    <div class="flex flex-col sm:flex-row justify-around items-center gap-2 text-center">
                        <div>
                            <span
                                class="text-[9px] text-gray-500 uppercase font-black tracking-widest block mb-1">Base</span>
                            <span class="text-lg font-black text-white tracking-tighter" id="val-base-disparo">0</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <span
                                class="text-[8px] text-brand-yellow font-black bg-brand-yellow/5 px-2 py-0.5 rounded-full mb-1"><span
                                    id="val-tx-leitura">0</span>% LERAM</span>
                            <i data-lucide="arrow-right" class="text-gray-700 hidden sm:block"></i>
                        </div>
                        <div>
                            <span
                                class="text-[9px] text-gray-500 uppercase font-black tracking-widest block mb-1">Lido</span>
                            <span class="text-lg font-black text-white tracking-tighter" id="val-leram-disparo">0</span>
                        </div>
                        <div class="flex flex-col items-center">
                            <span
                                class="text-[8px] text-brand-emerald font-black bg-brand-emerald/5 px-2 py-0.5 rounded-full mb-1"><span
                                    id="val-tx-conv">0</span>% CONV.</span>
                            <i data-lucide="arrow-right" class="text-gray-700 hidden sm:block"></i>
                        </div>
                        <div>
                            <span
                                class="text-[9px] text-gray-500 uppercase font-black tracking-widest block mb-1">Grupo</span>
                            <span class="text-lg font-black text-brand-emerald tracking-tighter"
                                id="val-entradas-disparo">0</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 mt-auto">
                    <div class="bg-gray-800/20 rounded-xl p-4 border border-gray-800/50">
                        <p class="text-[9px] text-gray-400 uppercase font-black tracking-widest mb-1">Custo Disparo</p>
                        <p class="text-lg font-black text-white tracking-tighter">R$ <span
                                id="val-gasto-disparo">0,00</span></p>
                    </div>
                    <div class="bg-[#25D366]/10 rounded-xl p-4 border border-[#25D366]/20">
                        <p class="text-[9px] text-[#25D366] uppercase font-black tracking-widest mb-1">CPA Canal</p>
                        <p class="text-lg font-black text-white tracking-tighter">R$ <span
                                id="val-cpa-disparo">0,00</span></p>
                    </div>
                </div>
            </section>
        </div>

        <section class="grid grid-cols-1 md:grid-cols-2 gap-6 opacity-0 animate-fade-in-up delay-300">
            <div class="glass-card rounded-2xl p-6 text-left">
                <h3 class="text-[10px] font-black text-gray-400 mb-8 uppercase tracking-[0.2em]">Composição de Entradas
                </h3>
                <div class="relative h-64 w-full"><canvas id="channelsChart"></canvas></div>
            </div>
            <div class="glass-card rounded-2xl p-6 text-left">
                <h3 class="text-[10px] font-black text-gray-400 mb-8 uppercase tracking-[0.2em]">CPA por Canal (R$)</h3>
                <div class="relative h-64 w-full"><canvas id="cpaChart"></canvas></div>
            </div>
        </section>
    </div>

    <script>
        lucide.createIcons();
        Chart.defaults.color = 'rgba(255,255,255,0.4)';
        Chart.defaults.font.family = "'Roc Grotesk', 'Archivo', sans-serif";
        Chart.defaults.font.weight = '700';

        let charts = {};
        const PLANILHA_URL = "https://docs.google.com/spreadsheets/d/1TJbEAP5_lWygPyi92Ll8Mgy7ovwprbV5q9AaRCFOm2E/export?format=csv";

        let data = {
            gasto_meta: 534.00, cliques_meta: 13, entradas_meta: 13,
            gasto_disparo: 730.14, base_disparo: 2300, leram_disparo: 1200, entradas_disparo: 75,
            entradas_organico: 51, meta_grupo: 300
        };

        const formatMoney = (val) => val.toFixed(2).replace('.', ',');
        const formatNumber = (val) => val.toLocaleString('pt-BR');

        async function fetchSpreadsheet() {
            if (!PLANILHA_URL) return;
            try {
                document.getElementById('status-text').innerText = "Sincronizando...";
                const res = await fetch(PLANILHA_URL);
                const csvText = await res.text();
                const rows = csvText.split('\n');
                rows.forEach(row => {
                    const cols = row.split(',');
                    if (cols.length >= 2) {
                        const key = cols[0].trim();
                        const value = parseFloat(cols[1].trim());
                        if (key && !isNaN(value)) data[key] = value;
                    }
                });
                document.getElementById('status-text').innerText = "Ativa";
            } catch (error) {
                document.getElementById('status-text').innerText = "Offline";
            }
        }

        function renderDashboard() {
            const gastoTotal = data.gasto_meta + data.gasto_disparo;
            const entradasTotais = data.entradas_meta + data.entradas_disparo + data.entradas_organico;
            const entradasPagas = data.entradas_meta + data.entradas_disparo;
            const cpaGeral = entradasPagas > 0 ? (gastoTotal / entradasPagas) : 0;
            const cpaMeta = data.entradas_meta > 0 ? (data.gasto_meta / data.entradas_meta) : 0;
            const cpcMeta = data.cliques_meta > 0 ? (data.gasto_meta / data.cliques_meta) : 0;
            const cpaDisparo = data.entradas_disparo > 0 ? (data.gasto_disparo / data.entradas_disparo) : 0;
            const gap = data.meta_grupo - entradasTotais;
            const porcentagemMeta = (entradasTotais / data.meta_grupo) * 100;
            const taxaLeitura = data.base_disparo > 0 ? (data.leram_disparo / data.base_disparo) * 100 : 0;
            const taxaConversaoDisparo = data.leram_disparo > 0 ? (data.entradas_disparo / data.leram_disparo) * 100 : 0;

            document.getElementById('val-gasto-meta').innerText = formatMoney(data.gasto_meta);
            document.getElementById('val-cliques-meta').innerText = formatNumber(data.cliques_meta);
            document.getElementById('val-entradas-meta').innerText = formatNumber(data.entradas_meta);
            document.getElementById('val-cpc-meta').innerText = formatMoney(cpcMeta);
            document.getElementById('val-cpa-meta').innerText = formatMoney(cpaMeta);
            document.getElementById('val-base-disparo').innerText = formatNumber(data.base_disparo);
            document.getElementById('val-leram-disparo').innerText = formatNumber(data.leram_disparo);
            document.getElementById('val-entradas-disparo').innerText = formatNumber(data.entradas_disparo);
            document.getElementById('val-tx-leitura').innerText = taxaLeitura.toFixed(1).replace('.', ',');
            document.getElementById('val-tx-conv').innerText = taxaConversaoDisparo.toFixed(1).replace('.', ',');
            document.getElementById('val-gasto-disparo').innerText = formatMoney(data.gasto_disparo);
            document.getElementById('val-cpa-disparo').innerText = formatMoney(cpaDisparo);
            document.getElementById('val-gap').innerText = gap > 0 ? formatNumber(gap) : 0;
            document.getElementById('val-atual-mini').innerText = formatNumber(entradasTotais);
            document.getElementById('val-meta').innerText = formatNumber(data.meta_grupo);

            document.getElementById('val-gasto-total').setAttribute('data-target', gastoTotal);
            document.getElementById('val-entradas-totais').setAttribute('data-target', entradasTotais);
            document.getElementById('val-cpa-geral').setAttribute('data-target', cpaGeral);
            document.getElementById('val-porcentagem').setAttribute('data-target', porcentagemMeta > 100 ? 100 : porcentagemMeta);

            setTimeout(() => { document.getElementById('progress-bar').style.width = `${porcentagemMeta > 100 ? 100 : porcentagemMeta}%`; }, 500);
            runCounters();
            renderCharts(data.entradas_meta, data.entradas_disparo, data.entradas_organico, cpaMeta, cpaDisparo, cpaGeral);
        }

        function runCounters() {
            const counters = document.querySelectorAll('.counter');
            counters.forEach(counter => {
                const target = parseFloat(counter.getAttribute('data-target'));
                const isDecimal = counter.hasAttribute('data-decimals');
                let count = 0;
                const updateCount = () => {
                    const inc = target / 60;
                    if (count < target) {
                        count += inc;
                        counter.innerText = isDecimal ? count.toFixed(2).replace('.', ',') : Math.ceil(count).toLocaleString('pt-BR');
                        setTimeout(updateCount, 16);
                    } else {
                        counter.innerText = isDecimal ? target.toFixed(2).replace('.', ',') : target.toLocaleString('pt-BR');
                    }
                };
                updateCount();
            });
        }

        function renderCharts(metaE, dispE, orgE, cpaMeta, cpaDisp, cpaGer) {
            if (charts.doughnut) charts.doughnut.destroy();
            if (charts.bar) charts.bar.destroy();
            const ctxChannels = document.getElementById('channelsChart').getContext('2d');
            charts.doughnut = new Chart(ctxChannels, {
                type: 'doughnut', plugins: [ChartDataLabels],
                data: {
                    labels: ['Meta Ads', 'WhatsApp', 'Orgânico'],
                    datasets: [{
                        data: [metaE, dispE, orgE],
                        backgroundColor: ['#1877F2', '#25D366', '#FFC700'],
                        borderWidth: 0,
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false, cutout: '65%',
                    plugins: {
                        legend: { position: 'bottom', labels: { usePointStyle: true, padding: 25, font: { size: 10, weight: '900' } } },
                        datalabels: { color: (c) => c.dataIndex === 2 ? '#000' : '#fff', font: { weight: '900', size: 14 }, formatter: (v) => v > 0 ? v : '' }
                    }
                }
            });
            const ctxCPA = document.getElementById('cpaChart').getContext('2d');
            charts.bar = new Chart(ctxCPA, {
                type: 'bar', plugins: [ChartDataLabels],
                data: {
                    labels: ['Meta Ads', 'WhatsApp', 'Média Geral'],
                    datasets: [{
                        data: [cpaMeta, cpaDisp, cpaGer],
                        backgroundColor: ['rgba(24, 119, 242, 0.8)', 'rgba(37, 211, 102, 0.8)', 'rgba(255, 199, 0, 0.8)'],
                        borderRadius: 8
                    }]
                },
                options: {
                    layout: { padding: { top: 25 } }, responsive: true, maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.05)', drawBorder: false }, ticks: { display: false } },
                        x: { grid: { display: false } }
                    },
                    plugins: {
                        legend: { display: false },
                        datalabels: { anchor: 'end', align: 'top', color: '#fff', font: { weight: '900', size: 12 }, formatter: (v) => 'R$ ' + v.toFixed(2).replace('.', ',') }
                    }
                }
            });
        }

        async function init() {
            const icon = document.getElementById('refresh-icon');
            if (icon) icon.classList.add('animate-spin');
            await fetchSpreadsheet();
            renderDashboard();
            if (icon) setTimeout(() => icon.classList.remove('animate-spin'), 600);
        }
        init();
    </script>
</body>

</html>